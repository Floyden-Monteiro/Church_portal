<!DOCTYPE HTML>
<html>
<head>
    <style>
        /* Integrated CSS styles */
        body {
            font-family: 'Source Sans Pro', Arial, sans-serif;
            line-height: 1.6;
            color: #ffffff;
            background-color: #fff;
        }
        .logo {
            width: 100px;
            height: 100px;
        }
        .form-section {
            margin-bottom: 20px;
            background-color: #658361;
            padding: 20px;
            border: 1px solid #4f4f4f;
            border-radius: 5px;
            opacity: 0.8;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin-bottom: 20px;
            margin:auto;
        }
        table, th, td {
            border: none;
            padding:8 px;
            color:#ffffff;
        }
        th, td {
            padding-top: 10px;
            padding-bottom: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            color:black;
        }
        .admin-form {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #mainForm label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        #mainForm select, #mainForm input[type="text"], #mainForm input[type="date"], #mainForm textarea, #mainForm input[type="file"] {
            width: calc(100% - 130px);
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #mainForm textarea {
            height: 150px;
        }
        #mainForm button {
            background-color: #658361;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        #mainForm button:hover {
            background-color: #0a520d;
        }
        .gototop {
            position: fixed;
            bottom: 30px;
            right: 20px;
            z-index: 999;
        }
        .gototop a {
            display: block;
            background: #000000;
            color: #ffffff;
            text-align: center;
            padding: 10px;
            text-decoration: none;
            border-radius: 5px;
        }
        .gototop a:hover {
            background: #767976;
        }
        button {
            align-content: center;
            padding: 1.3em 3em;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            font-weight: 500;
            color: #000;
            background-color: #fff;
            border: none;
            border-radius: 45px;
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease 0s;
            cursor: pointer;
            outline: none;
            }

            button:hover {
            background-color: #23c483;
            box-shadow: 0px 15px 20px rgba(46, 229, 157, 0.4);
            color: #fff;
            transform: translateY(-7px);
            }

            button:active {
            transform: translateY(-1px);
            }
    </style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Holy Spirit Church - Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Form Page" />
    <meta name="keywords" content="form, html, javascript" />
    <meta name="author" content="author" />

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700" rel="stylesheet">

    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/flexslider.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="js/modernizr-2.6.2.min.js"></script>
</head>
<body>
    <div class="fh5co-loader"></div>

    <div id="page">
        <nav class="fh5co-nav" role="navigation">
            <div class="container-wrap">
                <div class="top-menu">
                    <div class="row">
                        <div class="col-md-12 col-offset-0">
                            <div id="fh5co-logo"><img class="logo" src="images\logo.jpg"><a href="index.ejs" style=>Holy Spirit Church</a></div>
                        </div>
                        <div class="col-md-12 col-md-offset-0 text-center menu-1">
                            <ul>
                                <li class="active"><a href="index.ejs">Home</a></li>
                                <li >
                                    <a href="news.ejs">News</a>
                                </li>
                                <li><a href="events.ejs">Events</a></li>
                                <li class="has-dropdown"><a href="about.ejs">About Us</a>
                                    <ul class="dropdown">
                                        <li><a href="#">History</a></li>
                                        <li><a href="#">Location</a></li>
                                        <li><a href="#">Parish Council</a></li>
                                        <li><a href="#">Priests </a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                </div>
            </div>
        </nav>
        <div class="ham-verti">
            <label class="hamburger">
                <input type="checkbox">
                <svg viewBox="0 0 32 32">
                    <path class="line line-top-bottom" d="M27 10 13 10C10.8 10 9 8.2 9 6 9 3.5 10.8 2 13 2 15.2 2 17 3.8 17 6L17 26C17 28.2 18.8 30 21 30 23.2 30 25 28.2 25 26 25 23.8 23.2 22 21 22L7 22"></path>
                    <path class="line" d="M7 16 27 16"></path>
                </svg>
            </label>
        
            <!-- Side Vertical Navigation -->
            <nav class="vertical-menu-wrapper">
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script>
                $(document).ready(function() {
                    $('.hamburger input').on('change', function() {
                        $('body').toggleClass('show-menu');
                    });
                });
            </script>
                <div class="vertical-menu-logo">
                    <div>MENU</div>
                </div>
                <ul class="vertical-menu">
                    <li>Associations</li>
                    <li>Gallery</li>
                    <li>Payments</li>
                    <li>Institute</li>
                </ul>
            </nav>
        </div>
        <div class="admin-form">
            <h1>Form</h1>
            <form id="mainForm">
                <label for="formSelector">Choose a form:</label>
                <select id="formSelector" name="formSelector" onchange="generateForm()">
                    <option value="">Select a form</option>
                    <option value="News">News</option>
                    <option value="Ward Details">Ward Details</option>
                    <option value="priests">Priests</option>
                    <option value="obituary">Obituary</option>
                    <option value="history">History</option>
                    <option value="Parish Council">Parish Council</option>
                    <option value="institution">Institution</option>
                </select>
                <div id="formContainer"></div>
                <button type="button" onclick="submitForm()">Submit</button>
            </form>
            <a href="display.ejs">View Entries</a>
        </div>

        <div class="gototop js-top">
            <a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
        </div>
    </div>

    <script>
        function generateForm() {
            const formContainer = document.getElementById('formContainer');
            const selectedForm = document.getElementById('formSelector').value;

            formContainer.innerHTML = ''; // Clear any existing form

            let formHTML = '';
            switch (selectedForm) {
                case 'News':
                    formHTML = `
                        <div class="form-section" id="News">
                            <h3>News Form</h3>
                            <table>
                                <tr>
                                    <td><label for="type">Type:</label></td>
                                    <td>
                                        <select id="type" name="type" required>
                                            <option value="News">News</option>
                                            <option value="Announcements">Announcements</option>
                                            <option value="Events">Events</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td><label for="title">Title:</label></td>
                                    <td><input type="text" id="title" name="title" required></td>
                                </tr>
                                <tr>
                                    <td><label for="content">Content:</label></td>
                                    <td><textarea id="content" name="content" required></textarea></td>
                                </tr>
                                <tr>
                                    <td><label for="date">Date:</label></td>
                                    <td><input type="date" id="date" name="date" required></td>
                                </tr>
                                <tr>
                                    <td><label for="image">Image:</label></td>
                                    <td><input type="file" id="image" name="image"></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'Ward Details':
                    formHTML = `
                        <div class="form-section" id="ward">
                            <h3>Ward Details Form</h3>
                            <table>
                                <tr>
                                    <td><label for="wname">Ward Name:</label></td>
                                    <td><input type="text" id="wname" name="wname" required></td>
                                </tr>
                                <tr>
                                    <td><label for="place">Place:</label></td>
                                    <td><input type="text" id="place" name="place" required></td>
                                </tr>
                                <tr>
                                    <td><label for="wdescription">Description:</label></td>
                                    <td><textarea id="wdescription" name="wdescription" required></textarea></td>
                                </tr>
                                <tr>
                                    <td><label for="wimage">Image:</label></td>
                                    <td><input type="file" id="wimage" name="wimage"></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'priests':
                    formHTML = `
                        <div class="form-section" id="priests">
                            <h3>Priests Form</h3>
                            <table>
                                <tr>
                                    <td><label for="pname">Name:</label></td>
                                    <td><input type="text" id="pname" name="pname"></td>
                                </tr>
                                <tr>
                                    <td><label for="fdate">Serving From:</label></td>
                                    <td><input type="date" id="fdate" name="fdate"></td>
                                </tr>
                                <tr>
                                    <td><label for="tdate">Serving To:</label></td>
                                    <td><input type="date" id="tdate" name="tdate"></td>
                                </tr>
                                <tr>
                                    <td><label for="pimage">Image:</label></td>
                                    <td><input type="file" id="pimage" name="pimage"></td>
                                </tr>
                                <tr>
                                    <td><label for="contact">Contact:</label></td>
                                    <td><input type="text" id="contact" name="contact"></td>
                                </tr>
                                <tr>
                                    <td><label for="pdescription">Description:</label></td>
                                    <td><textarea id="pdescription" name="pdescription"></textarea></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'obituary':
                    formHTML = `
                        <div class="form-section" id="obituary">
                            <h3>Obituary Form</h3>
                            <table>
                                <tr>
                                    <td><label for="name">Name:</label></td>
                                    <td><input type="text" id="name" name="name" required></td>
                                </tr>
                                <tr>
                                    <td><label for="image">Image:</label></td>
                                    <td><input type="file" id="image" name="image"></td>
                                </tr>
                                <tr>
                                    <td><label for="description">Description:</label></td>
                                    <td><textarea id="description" name="description" required></textarea></td>
                                </tr>
                                <tr>
                                    <td><label for="odate">Date:</label></td>
                                    <td><input type="date" id="odate" name="odate" required></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'history':
                    formHTML = `
                        <div class="form-section" id="history">
                            <h3>History Form</h3>
                            <table>
                                <tr>
                                    <td><label for="content">Content:</label></td>
                                    <td><textarea id="content" name="content" required></textarea></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'Parish Council':
                    formHTML = `
                        <div class="form-section" id="pcouncil">
                            <h3>Parish Council Form</h3>
                            <table>
                                <tr>
                                    <td><label for="pcname">Name:</label></td>
                                    <td><input type="text" id="pcname" name="pcname" required></td>
                                </tr>
                                <tr>
                                    <td><label for="pcimage">Image:</label></td>
                                    <td><input type="file" id="pcimage" name="pcimage"></td>
                                </tr>
                                <tr>
                                    <td><label for="pccontact">Contact:</label></td>
                                    <td><input type="text" id="pccontact" name="pccontact" required></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'institution':
                    formHTML = `
                        <div class="form-section" id="institution">
                            <h3>Institution Form</h3>
                            <table>
                                <tr>
                                    <td><label for="iname">Institution Name:</label></td>
                                    <td><input type="text" id="iname" name="iname"></td>
                                </tr>
                                <tr>
                                    <td><label for="iimage">Image:</label></td>
                                    <td><input type="file" id="iimage" name="iimage"></td>
                                </tr>
                                <tr>
                                    <td><label for="idescription">Description:</label></td>
                                    <td><textarea id="idescription" name="idescription"></textarea></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                default:
                    formHTML = '';
                    break;
            }

            formContainer.innerHTML = formHTML;
        }

        function submitForm() {
            const form = document.getElementById('mainForm');
            const formData = new FormData(form);
            const selectedForm = document.getElementById('formSelector').value;

            if (!selectedForm) {
                alert('Please select a form type.');
                return;
            }

            const formValues = {};
            formData.forEach((value, key) => {
                formValues[key] = value;
            });

            let dataStore = JSON.parse(localStorage.getItem('formData')) || {};
            if (!dataStore[selectedForm]) {
                dataStore[selectedForm] = [];
            }

            dataStore[selectedForm].push(formValues);
            localStorage.setItem('formData', JSON.stringify(dataStore));

            window.location.href = 'display.ejs'; // Redirect to the display page
        }
    </script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('token');
        console.log(token);
        if (!token) {
            window.location.href = '/login';
        }
    });

    const form = document.getElementById('mainForm');
    form.addEventListener('submit', (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        const token = localStorage.getItem('token');

        fetch('/app/admin', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.status === 401) {
                window.location.href = '/login';
            }
            return response.json();
        })
        .then(result => {
            if (result.success) {
                alert('Data added successfully');
                form.reset();
            } else {
                alert('Failed to add data');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred');
        });
    });
</script>

    <script>
        window.onload = function() {
            const editItem = JSON.parse(localStorage.getItem('editItem'));

            if (editItem) {
                const { formType, index, item } = editItem;
                document.getElementById('formSelector').value = formType;
                generateForm();

                for (const [key, value] of Object.entries(item)) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = value;
                    }
                }

                // Remove the edit item from localStorage
                localStorage.removeItem('editItem');

                // Update the form submission function to handle the edit case
                const originalSubmitForm = submitForm;
                submitForm = function() {
                    const form = document.getElementById('mainForm');
                    const formData = new FormData(form);
                    const formValues = {};
                    formData.forEach((value, key) => {
                        formValues[key] = value;
                    });

                    let dataStore = JSON.parse(localStorage.getItem('formData')) || {};
                    dataStore[formType][index] = formValues;
                    localStorage.setItem('formData', JSON.stringify(dataStore));
                    window.location.href = 'display.ejs'; // Redirect to the display page
                };
            }
        }
    </script>

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.flexslider-min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/magnific-popup-options.js"></script>
    <script src="js/jquery.countTo.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
